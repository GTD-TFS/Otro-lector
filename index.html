<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OCR b√°sico ‚Äì Foto o archivo</title>
  <link rel="preconnect" href="https://unpkg.com">
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; padding: 1rem; background: #f6f7f9; color: #111; }
    .app { max-width: 700px; margin: 0 auto; background: #fff; border-radius: 12px;
           padding: 1rem; box-shadow: 0 6px 30px rgba(0,0,0,.06); }
    h1 { font-size: 1.25rem; margin-bottom: 1rem; }
    .row { display: flex; flex-wrap: wrap; gap: .5rem; align-items: center; margin-bottom: .75rem; }
    label { font-weight: 600; }
    input[type="file"], select, button, textarea {
      padding: .6rem .7rem; border: 1px solid #dfe3e6; border-radius: 10px; background: #fff; font-size: 1rem;
    }
    button.primary { background: #111; color: #fff; border: none; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .preview { width: 100%; max-height: 360px; object-fit: contain; border-radius: 10px; background: #f0f2f5; }
    progress { width: 100%; height: 14px; }
    textarea { width: 100%; min-height: 200px; resize: vertical; }
    footer { margin-top: 1rem; color: #667; font-size: .9rem; }
  </style>
</head>
<body>
  <div class="app">
    <h1>OCR b√°sico (foto o archivo)</h1>

    <div class="row">
      <button id="fotoBtn" type="button" class="primary">üì∏ Hacer foto</button>
      <input id="fotoInput" type="file" accept="image/*" capture="environment" hidden>

      <button id="archivoBtn" type="button">üìÅ Elegir archivo</button>
      <input id="archivoInput" type="file" accept="image/*" hidden>
    </div>

    <div class="row">
      <label for="lang">Idioma del texto</label>
      <select id="lang">
        <option value="spa" selected>Espa√±ol</option>
        <option value="eng">Ingl√©s</option>
      </select>
    </div>

    <div class="row">
      <button id="run" class="primary" type="button">Leer texto</button>
      <button id="clear" type="button">Limpiar</button>
    </div>

    <div class="row">
      <progress id="progress" max="1" value="0"></progress>
      <span id="status">Listo.</span>
    </div>

    <img id="preview" class="preview" alt="Vista previa" />

    <div class="row">
      <label for="output">Texto detectado</label>
      <textarea id="output" placeholder="Aqu√≠ aparecer√° el texto reconocido‚Ä¶"></textarea>
    </div>

    <footer>
      Puedes usar la c√°mara o elegir una imagen del dispositivo.
    </footer>
  </div>

  <!-- Tesseract.js -->
  <script src="https://unpkg.com/tesseract.js@5.1.0/dist/tesseract.min.js"></script>
  <script>
    const $ = id => document.getElementById(id);
    const fotoBtn = $('fotoBtn');
    const fotoInput = $('fotoInput');
    const archivoBtn = $('archivoBtn');
    const archivoInput = $('archivoInput');
    const runBtn = $('run');
    const clearBtn = $('clear');
    const preview = $('preview');
    const progress = $('progress');
    const status = $('status');
    const output = $('output');
    const langSel = $('lang');

    let currentBlob = null;

    // --- seleccionar foto (c√°mara) ---
    fotoBtn.addEventListener('click', () => fotoInput.click());
    fotoInput.addEventListener('change', () => {
      const f = fotoInput.files?.[0];
      if (!f) return;
      currentBlob = f;
      preview.src = URL.createObjectURL(f);
      status.textContent = 'Foto cargada.';
    });

    // --- seleccionar archivo (galer√≠a o explorador) ---
    archivoBtn.addEventListener('click', () => archivoInput.click());
    archivoInput.addEventListener('change', () => {
      const f = archivoInput.files?.[0];
      if (!f) return;
      currentBlob = f;
      preview.src = URL.createObjectURL(f);
      status.textContent = 'Archivo cargado.';
    });

    // --- limpiar ---
    clearBtn.addEventListener('click', () => {
      currentBlob = null;
      fotoInput.value = '';
      archivoInput.value = '';
      preview.removeAttribute('src');
      output.value = '';
      progress.value = 0;
      status.textContent = 'Listo.';
    });

    // --- leer texto ---
    runBtn.addEventListener('click', async () => {
      if (!currentBlob) return status.textContent = 'Selecciona o haz una foto primero.';
      const lang = langSel.value || 'spa';
      output.value = '';
      progress.value = 0;
      status.textContent = 'Reconociendo texto‚Ä¶';

      try {
        const worker = await Tesseract.createWorker(lang, 1, {
          logger: m => {
            if (m.status === 'recognizing text' && m.progress != null) {
              progress.value = m.progress;
              status.textContent = `Reconociendo‚Ä¶ ${Math.round(m.progress * 100)}%`;
            }
          },
          workerPath: 'https://unpkg.com/tesseract.js@5.1.0/dist/worker.min.js',
          corePath: 'https://unpkg.com/tesseract.js-core@5.0.0/tesseract-core.wasm.js',
        });

        await worker.setParameters({ tessedit_pageseg_mode: 6 });

        const { data } = await worker.recognize(currentBlob);
        output.value = data.text.trim();
        status.textContent = 'Completado ‚úî';
        progress.value = 1;

        await worker.terminate();
      } catch (err) {
        console.error(err);
        status.textContent = 'Error: ' + err.message;
      }
    });
  </script>
</body>
</html>


