<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Visor ‚Äî Buscar en dispositivo (siempre horizontal)</title>
<style>
  :root { --bg:#f6f7f9; --fg:#111; --card:#fff; }
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .app{max-width:920px;margin:0 auto;padding:1rem}
  .card{background:var(--card);padding:1rem;border-radius:14px;box-shadow:0 8px 34px rgba(0,0,0,.06)}
  h1{margin:.25rem 0 1rem}
  #stage{width:100%;aspect-ratio:16/9;background:#000;border-radius:12px;display:block}
  .toolbar{margin-top:.75rem;display:flex;justify-content:center}
  label.btn{padding:.7rem 1rem;border-radius:10px;background:#111;color:#fff;cursor:pointer}
  label.btn input{display:none}
  #status{margin-top:.5rem;text-align:center;color:#555}
</style>
</head>
<body>
<div class="app">
  <div class="card">
    <h1>Buscar imagen (normalizada a horizontal)</h1>

    <canvas id="stage"></canvas>
    <div id="status">Elige una foto del dispositivo. Si ven√≠a ‚Äúen vertical‚Äù, la ver√°s corregida a horizontal.</div>

    <div class="toolbar">
      <label class="btn">üñºÔ∏è Buscar en dispositivo
        <input id="file" type="file" accept="image/*">
      </label>
    </div>
  </div>
</div>

<script>
(() => {
  const stage = document.getElementById('stage');
  const ctx = stage.getContext('2d', { willReadFrequently:true });
  const fileInput = document.getElementById('file');
  const statusEl = document.getElementById('status');

  // Canvas l√≥gico de salida (siempre horizontal 16:9, resoluci√≥n alta)
  const OUT_W = 1600, OUT_H = 900;
  stage.width = OUT_W; stage.height = OUT_H;

  // Dibuja la imagen en horizontal: si viene vertical, la rotamos 90¬∫ primero; luego recorte COVER a 16:9
  function drawAsHorizontal(imgBitmap){
    // 1) Normalizar orientaci√≥n: si la fuente es vertical, rotarla 90¬∞
    const sw0 = imgBitmap.width, sh0 = imgBitmap.height;
    const src = document.createElement('canvas');
    const sctx = src.getContext('2d');

    if (sh0 > sw0) {
      // rotar a paisaje (90¬∞ clockwise)
      src.width = sh0; src.height = sw0;
      sctx.translate(src.width/2, src.height/2);
      sctx.rotate(Math.PI/2);
      sctx.drawImage(imgBitmap, -sw0/2, -sh0/2);
    } else {
      src.width = sw0; src.height = sh0;
      sctx.drawImage(imgBitmap, 0, 0);
    }

    // 2) Recorte COVER a 16:9 sobre el canvas de salida
    const sw = src.width, sh = src.height;
    const targetRatio = OUT_W / OUT_H; // 16:9
    const srcRatio = sw / sh;
    let sx, sy, cw, ch;
    if (srcRatio > targetRatio) {
      // sobra ancho -> recortamos laterales
      ch = sh; cw = Math.round(sh * targetRatio);
      sx = Math.round((sw - cw)/2); sy = 0;
    } else {
      // sobra alto -> recortamos arriba/abajo
      cw = sw; ch = Math.round(sw / targetRatio);
      sx = 0; sy = Math.round((sh - ch)/2);
    }

    // 3) Pintar al canvas visible (lo que ves = lo que usar√°s despu√©s)
    ctx.clearRect(0,0,OUT_W,OUT_H);
    ctx.drawImage(src, sx, sy, cw, ch, 0, 0, OUT_W, OUT_H);
  }

  fileInput.addEventListener('change', async (e) => {
    const file = e.target.files?.[0]; if (!file) return;
    statusEl.textContent = 'Cargando imagen‚Ä¶';
    try {
      const bmp = await createImageBitmap(file);
      drawAsHorizontal(bmp);
      statusEl.textContent = '‚úÖ Imagen cargada y normalizada a horizontal.';
    } catch (err) {
      console.error(err);
      statusEl.textContent = '‚ùå No se pudo cargar la imagen.';
    } finally {
      fileInput.value = '';
    }
  });
})();
</script>
</body>
</html>
